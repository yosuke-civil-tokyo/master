\chapter{対象問題と提案アルゴリズム}
\label{3}
本章では，グラフ構造推定に導入する提案手法の記述を行う．はじめに3.1節でObjectの導入による解空間削減手法を述べた後，3.2節では深層生成モデルによるモデル平均化手法について述べる．

\section{解空間を削減したグラフ推定手法}
\label{3.1}
本節で導入する解空間削減手法では，Object-Oriented Bayesian Networks(OOBN)[4]でBNに導入されたObjectの概念を用いる．グラフ推定の手法としては，Ordered-based Searchを用い，変数順序配列$order[]$に対して制約を設けることで解空間が削減される．

グラフの推定は，Ordered-based Search[5]を採用する．この際，複数の変数$X_i$を１つのObject$O_l$に格納する．ABMの文脈では，Objectは個人属性や活動パターン，目的地選択といった計算要素を表現し，変数は事前知識に基づいて近い属性のObjectに格納される．この時，同一のobjectに属する変数を変数順序配列の中で連続させることによって，変数の順序配列$order[]=(X_1,…, X_i,X_(i+1)…,X_I )$を決定する問題は，Object順序配列$order_L []=(O_1,…, O_l,O_(l+1)…,O_L)$と，各Object$O_l$内での変数順序配列$order^l []=(X_1,…, X_i,X_(i+1)…,X_(I^l ))$を決定する問題へと変換することができる．Object内での変数順序配列が変わることによる，Object順序配列$order_L []$の決定問題への影響を無視すると，グラフの推定問題は，$order[]$の探索操作から，$order_L []$の探索と$order^l [] for l=1,…,L$の探索を順番に行う操作に変換できる．この際の探索が必要な変数順序配列の総数は，均等に$L$個のObjectに変数を格納した場合，$I!$から$L!(I/L !)^L$へと削減される．変数の数と取りうるグラフ構造の数(循環含む)を示した図１から，変数の数が増加するとObjectを導入することによる解空間の削減が，既存のエッジを固定する方法に比べて大きいことが分かる．

\section{部分構造のスコアを考慮したモデル平均化}
本節で提案するグラフ構造のモデル平均化手法では，深層生成モデルを用いることで，変数ごとに高スコア値を返す部分構造を採用するようにグラフ構造を生成する．グラフ構造を生成する深層生成モデルの研究は，D-VAE(Zhang et al., 2019)[12]をはじめに多数提案されている．D-VAEはVariational Auto EncoderにDAGグラフ構造を学習させることで低次元の潜在変数へと埋め込み，DAGのサンプリングを可能とした．このDAG生成器を用いて，BNの構造学習を行なっている．

モデル平均化の問題では，入力は多数の学習で得られたグラフ構造の集合であり，求められる出力は入力集合内のグラフ構造を平均化して得られる高スコアなグラフ構造である．そのため提案手法では，変数ごとの高スコアな親変数集合$Π_i$をグラフの部分構造として持つグラフを生成することで高スコアなグラフを生成する，深層生成モデルを用いてモデル平均化を行う．

用いるモデルは，Conditional VAE[6]である．本研究でのモデル構造を図２に示す．学習時には，学習結果のグラフ構造集合から，グラフ隣接行列$M^k$と正規化された各変数のBICスコア配列$(BIC^k (X_1 ),…,BIC^k (X_I ))$  を入力とし，encoderにより潜在変数へと埋め込まれる．その後，潜在変数はBICスコアと共にdecoderによってグラフ隣接行列へと復元される．生成時には，BICスコア配列と分布からサンプルした潜在変数を与えることで，BICスコア配列により条件付けされた分布からグラフ隣接行列$M^average$が得られる．生成時のBICスコア配列として，全変数に対して高い値を入力することで，各変数に対して高スコアな親変数集合を採用したグラフ構造を生成することが可能である．4章の実験では，全値が2.0(上位98\%)のBIC配列で条件付けて構造を生成した．生成されるグラフ構造がDAGであることは保証されていないため，グラフの非循環性を判定し，平均化グラフとする．
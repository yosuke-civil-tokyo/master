\chapter{序論} 
\label{1}
\section{研究の背景}\label{1.1}
交通需要の予測のために，近年ではActivity-based Model（ABM）の研究と開発が行われている．
既存の四段階推定法が交通需要を集計的に，かつ複数の計算プロセスをそれぞれ予測する複数の独立したモデルの集合であるのに対して，ABMは交通需要を活動の派生需要として捉え，個人単位の活動スケジュールを一括で予測するモデルである\cite{Xiang1997}．
これによりABMは，計算プロセス間の整合性を図りつつ\cite{Xiang1997}，より詳細かつ複数の集計単位での分析を可能にしている．

一方で，多数の変数を扱うABMは，その計算を行うために複雑なモデル構造を要する．
ABMではモデル内で行われる変数の計算プロセス（モデル構造と呼ぶ）により各個人の行動選択構造を記述し，活動スケジュールの生成を行なっている．
ABMのモデル構造は，離散選択モデルや，ヒューリスティクスにより行動選択を模倣した計算プロセスといった既存の知識を部分構造とした集積であり\cite{Xiang1997}，選択する部分構造やその組み合わせにより，モデルの活動生成精度や計算性能は大きな影響を受ける．
複数のモデル構造が提案される主な目的は，ヒューリスティクスや統計の知識を用いることで部分構造やモデルの全体構造を変更し，現実に近い個人の行動選択を記述することで，活動生成の精度を向上させることである\cite{Xiang1997}．
加えて，モデルの用途に応じてより詳細な変数を扱う\cite{Xiang1997}，新たな種類のデータをデータ同化に用いる\cite{Xiang1997}，といった目的に応じて，モデル構造が提案・採用されてきた．
既存・新規のモデルの中から適したモデル構造を選択することは，重要な課題である一方，試行錯誤を要する．
試行錯誤によりモデル構造を選択・構築することは，低精度のモデルを採用する可能性やモデルの利用までに時間がかかる，データ同化手法が確立されないといった問題が挙げられている\cite{Xiang1997}．

モデル構造をデータに応じて選択する目的で，Bayesian Networks（BN）を用いる提案がABMの分野で行われている．
BNは，変数間の依存関係を有効非循環グラフ，Directed Acyclic Graph（DAG）の形で表現する確率モデル（グラフィカルモデル）の一種である．
グラフ構造の推定を行うことで，データに応じて変数間の依存関係を表現することができ，系内の変数間関係が明らかでない〜〜といった分野で用いられている\cite{Xiang1997}．
ABMにおいても，Ma(2015)\cite{Xiang1997}により交通手段選択に影響を持つ変数の選択に用いられたことをはじめとして，近年では，多変数を生成する必要があるスケジュールの生成問題\cite{Xiang1997}に対しても適用されている．
BNをABMとして利用する利点は，データに応じたモデル構造の選択が可能であるという既存のABMに対する利点に加えて，変数間の依存関係を明示的にモデル化することで，施策検証の際の説明性や利便性，モデル弾性が，近年発達する深層生成モデルに比べて高いことが挙げられる\cite{Xiang1997}．
BNをABMとして採用することによって，
一方で，多数の変数から成るスケジュールを精度良く生成するABMとして運用する上では，問題点も指摘されている．

一つの大きな課題は，グラフ構造の推定問題である．
BNモデルを利用するためには，グラフ構造の推定問題と，エッジで結ばれた変数と変数の関係を記述するパラメータの推定問題の二つを解く必要がある．
グラフ構造の推定問題は，変数をノードとする全てのDAGの集合の中から，データに対して最も適合するグラフ構造を選択する問題である．
データに対する適合は，スコア関数を用いて評価することができ，BICがスコアとして採用される\cite{Xiang1997}．
これにより，グラフ構造の推定問題は，スコア関数を最大化する構造を見つける離散最適化問題として捉えられる．
本問題は，探索するグラフ構造の数が非循環の制約を考慮しない場合には変数の個数$N$を用いて指数計算量$2^{N^2}$と表せる，NP困難な問題であり，変数の数が増えると厳密解を得るアルゴリズムには多大な時間を要する\cite{Xiang1997}．
このため，貪欲法を用いて局所解を探索するアルゴリズムの研究が進んでおり\cite{Xiang1997}，ABMとして利用される際も，貪欲法により探索されたグラフ構造を採用している．
しかしながら，貪欲法により得られる局所解は初期値に大きく依存しており，学習毎に異なるグラフ構造が出力されることが知られている\cite{Xiang1997}．
最適でないグラフ構造を採用した場合，本来依存関係のある変数との関係を除外した，又は依存関係が逆に推定されたBNモデルが採用される可能性がある．
ABMの分野では，こうしたBNモデルを採用した場合，スケジュール生成の精度だけでなく，施策検証時のモデル弾性が現実（＝データ）に即した値にならないという問題が生じる．
そのため，初期値に依存せず，最適解に近いグラフ構造を高速に探索するアルゴリズムが必要である．

もう一つの課題は，ABMに採用されている既存のBNでは，変数間の関係にはシンプルな線形関係しか表現できない点である\cite{Xiang1997}．
ABMでは，個人がスケジュールを構築する際のヒューリスティクスに準ずる，ルールベースの計算により，より現実に即したスケジュールの生成を行なっている．
時空間制約や，それに基づく活動のリサンプリングは，スケジュール生成の精度を向上させる主要な手法であり，多くのABMで採用されている\cite{Xiang1997}．
こうした既存知識に基づく計算手続きが導入されていないBNでは，生成されたスケジュールに実行不可能，又は最後の活動目的地が自宅以外になるといった非現実的な活動が含まれる可能性がある．
BNをABMとして利用する際には，既存知識の活用を組み込めるような構造を導入することにより，その生成するスケジュールを妥当なものにすることが，活動分析や施策評価の上で重要であることが考えられる．

\section{研究の目的}\label{1.2}
本研究の目的は，BNをABMとして利用する際の課題を解決することである．

はじめに，BNのグラフ構造推定を高速に，かつ安定して行う手法を提案する．
提案手法では，Objectの上位概念に変数を格納することで，解空間を削減し，計算時間を短縮する．
また，局所解の初期値依存問題を解決するため，モデル平均化の手法を提案する．
パラメータ等の連続値に対して大きく発展しているモデル平均化であるが\cite{Xiang1997}，離散問題であるグラフ構造推定では，性能の良いモデル平均化の手法が確立されていない\cite{Xiang1997}．
提案するモデル平均化手法では，グラフの部分構造とそのスコアを考慮して，高スコアな部分構造を採用することで，グラフの全体構造を選択する．

次に，ヒューリスティクスを導入できるABMとしてBNを構築し，実データを用いた実証を行う．
線形の確率関係に加えて，ヒューリスティクスに基づく操作を導入することで，生成される個々のスケジュールをより現実に即したものとする．
実データを用いた既存BN，既存ABMとの比較を通して，提案するBNのABMとしての有効性を検証する．

\section{構成}\label{1.3}
本論文の構成を，以下に示す．図にフレームワークを示した．

本章では，本研究の背景を述べ，それを踏まえた上で目的を示した．

第２章では，既往研究の整理と本研究の位置付けを行う．
はじめに，既存のABMについて整理し，BNをABMとして用いる際の利点と課題を示す．
既存のABMについては，主に採用されているモデル構造と事前知識の活用について整理する．
その上で，BNをABMとして利用している研究を挙げ．その利点と課題を整理する．
次に，BNのグラフ構造推定問題と推定手法について整理する．
特に貪欲法による推定手法について，本研究で使用する，変数順序配列に基づき構造を探索する手法について整理し，それら手法の初期値依存性を触れる．
また，グラフ構造推定問題における，モデル平均化の手法とその問題点について整理する．

第３章では，本研究で提案するグラフ構造推定手法について述べる．
本研究では，Objectの概念を導入したBNの拡張である，Object-oriented Bayesian Networks（OOBN）\cite{Xiang1997}を用いる．
Objectに変数を格納したBNにおいて，変数順序配列に基づくグラフ構造推定手法\cite{Xiang1997}を採用し，解空間を大幅に削減する手法を提案する．
本提案手法は，初期値に依存する貪欲法解法である．
そのため，複数の推定結果を統合するモデル平均化手法を次に提案する．
提案手法では，グラフの部分構造を隣接行列の形式で入力し，その部分構造のスコアで条件付けたグラフ構造を出力する深層生成モデル\cite{Xiang1997}を用いて，高スコアな構造を生成する．
その後，提案手法の有効性を，既存のBNのグラフ構造推定手法との比較を通して検証する．
検証では，グラフ推定の正確性と計算時間といったBN分野の指標に加えて，変数感度をはじめとするABM分野の指標を用いて，提案手法により得られたグラフ構造の有効性を検証する．

第４章では，ヒューリスティクスを導入したBNを構築し，ABMとしての検証を，実データを用いて行う．
Object内に格納した変数を用いて，ルールベースの計算をBNによる活動生成に導入するABMを提案する．
その後，既存のABMとの性能比較を通して，提案するABMの有効性を検証する．
性能比較では，東京PTの実データを用い，これまで他のBNでは行われていない詳細なスケジュール予測設定の元，スケジュール生成の精度を比較する．

最後に第５章では，BNのABMとしての表現力や計算性能についてまとめ，今後の課題を示す．